\chapter{Optimizing network-utilization by balancing workload}
\label{chap:balancing}

\todo{TODO Add somewhere why A* is not used}

The last chapter brings an overview of different notations, algorithms and techniques.
In this chapter, all these instruments are combined to a chain for distributing routes more evenly, that are preferred by routing-algorithms like \gls{dijkstra}.
The goal is to augment a given graph, such that diverse alternative paths can be found and used to spread the load (of a typical workload) while limiting the detours of individual \glspl{stpair}.
\todo{TODO wording, especially because of the following definitions}

For a given \gls{stpair} and a graph $G = (V, E)$ with vertices $V$ and edges $E$ of $d$-dimensional edge-weights, a path should be found through an algorithm, that implicitly tends to distribute found paths over the network while keeping the paths' costs sufficiently near every cost-dimension's optimum.
To achieve this, a preprocessing-phase called \textit{balancing} analyzes the graph $G$ and computes a new metric for every edge.
With this metric, routing-algorithms like \gls{dijkstra} \todo{TODO Check whether \gls{dijkstra} improves distribution on its own or whether \gls{personalized_routing} is a must.} (with \gls{personalized_routing}) and cyclops can compute paths as usual.

This \textit{balancing} is depicted in figure~\ref{fig:balancing}.
At first, the graph, that should be balanced, has to be read in, resulting in $G = (V, E)$ of $d$ metrics.
This graph $G$ is contracted via \gls{contraction-hierarchies}.
The step of contracting is not needed for correctness, but reduces the needed runtime (even if $G$ is not fully contracted).


\begin{figure}
    \centering
    \input{res/graphics/balancing}
    \caption[Overview of balancing a graph]{%
        This flow shows the balancer, that analyzes a given graph $G$.
        Shapes for actions are rectangular and blue, shapes for data are elliptical and red.
        A metric is created and updated, that distributes upcoming workload (like during rush-hour) more evenly over the graph.
        \label{fig:balancing}
    }
\end{figure}

\todo{TODO Routes within a certain tolerance of the best possible cost (per metric, e.g. duration must be not worse than $25~\%$ \todo{tolerance should match the resulting plots}) are randomly chosen from cyclops.}

TODOs
\begin{enumerate}
    \item \todo{both approaches: multiple runs (explicit euler because workload is toggling) vs multiple metrics}
    \item \todo{highlights, what was difficult/much work? -> repo-link}
    \item \todo{implementation -> sub-chapter of chapter 3}
    \item \todo{normalization of all metrics -> comparability between different graphs}
\end{enumerate}

\input{src/content/balancing/implementation}